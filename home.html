<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <style>
        #h1-main {
            font-family: 'Oswald', sans-serif;
            color: black;
            height: 10%;
            position: fixed;
            z-index: 100;
            right: calc((100%  - 10% - 20px)/2)
        }
    </style>
    <script>
        function replace_Text(){
            var text_style = document.getElementById("h1-main").style;
            var text = document.getElementById("h1-main").innerHTML = "Playing..."
            text_style.color = "white";
            text_style.textAlign = "center";
            text_style.height = "15vh"
            console.log("replaced")
        }
        window.onload = function() {
  
            var file = document.getElementById("thefile");
            var audio = document.getElementById("audio");
  
            file.onchange = function() {
                var files = this.files;
                audio.src = URL.createObjectURL(files[0]);
                audio.load();
                audio.play();
                var context = new AudioContext();
                var src = context.createMediaElementSource(audio);
                var analyser = context.createAnalyser();

                var canvas = document.getElementById("canvas");
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                var ctx = canvas.getContext("2d");

                src.connect(analyser);
                analyser.connect(context.destination);

                analyser.fftSize = 256;

                var bufferLength = analyser.frequencyBinCount;
                var dataArray = new Uint8Array(bufferLength);

                var WIDTH = canvas.width;
                var HEIGHT = canvas.height;

                var barWidth = (WIDTH / bufferLength) * 2.5;
                var barHeight;
                var x = 0;

                function renderFrame() {
                    requestAnimationFrame(renderFrame);

                    x = 0;

                    analyser.getByteFrequencyData(dataArray);

                    ctx.fillStyle = "#000";
                    ctx.fillRect(0, 0, WIDTH, HEIGHT);

                    for (var i = 0; i < bufferLength; i++) {
                        barHeight = dataArray[i] * 6;
                        
                        var r = barHeight + (25 * (i/bufferLength))/5;
                        var g = (250 * (i/bufferLength))/5; // 250
                        var b = 50/5;

                    //   if (i % 5 == 0){
                    //       console.log(r, g, b, barHeight)
                    //   }

                        ctx.fillStyle = "rgb(" + r + "," + g + "," + b + ")";
                        ctx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);

                        x += barWidth + 1;
                }
            }

            audio.play();
            renderFrame();
            replace_Text();
        };
    };
        
    </script>
    <title>AudioViz</title>
</head>
<body>
    <div id="content">
        <div id="line-1">
            <input type="file" id="thefile" accept="audio/*" />
            <h1 id="h1-main">Add an audio file</h1>
        </div>
        <!-- <input type="file" id="thefile" accept="audio/*" /> -->
        <canvas id="canvas"></canvas>
        <audio id="audio" controls></audio>
      </div>
</body>
<script src="client.js"></script>
</html>